<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- Make website responsive -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="color-scheme" content="dark light">
        <meta description="A website built to allow users to send a pre-defined email (which they can preview) to multiple, pre-defined recipients (which they can preview in their email app).">
        <title>Email Sender</title>
        <link href="./styles.css" rel="stylesheet"/>
        <script>
            let emailMessageBody = `Email message body

            `;

            let subjectLine = `Subject Line`;

            function normaliseString(str) {
                // Define a mapping of accented letters to their non-accented equivalents
                const charMap = {
                    'à': 'a',
                    'á': 'a',
                    'ä': 'a',
                    'é': 'e',
                    'è': 'e',
                    'ê': 'e',
                    'ë': 'e',
                    'í': 'i',
                    'î': 'i',
                    'ï': 'i',
                    'ì': 'i',
                    'ó': 'o',
                    'ô': 'o',
                    'ö': 'o',
                    'ú': 'u',
                    'û': 'u',
                    'ü': 'u',
                    'ū': 'u',
                    'ç': 'c',
                    'À': 'A',
                    'Á': 'A',
                    'Ä': 'A',
                    'É': 'E',
                    'È': 'E',
                    'Ê': 'E',
                    'Ë': 'E',
                    'Í': 'I',
                    'Ì': 'I',
                    'Î': 'I',
                    'Ï': 'I',
                    'Ó': 'O',
                    'Ô': 'O',
                    'Ö': 'O',
                    'Ú': 'U',
                    'Û': 'U',
                    'Ü': 'U',
                    'Ū': 'U',
                    'Ç': 'C',
                    // Add more mappings as needed
                    // **********TODO also move to Javascript file**********
                };

                // Use a regular expression to replace special characters
                return str.replace(/[àáäéèêëíîìïóôöúûüūçÀÁÄÉÈÊËÍÌÎÏÓÔÖÚÛÜŪÇ]/g, match => charMap[match] || match);
            }

            function sendEmail() {
                // Get user's signature from text area
                let signature = document.getElementById("signature").value;

                // Replace spaces with space characters
                signature = signature.replace(/ /g, " ");

                // Normalise signature by replacing special characters
                let normalisedSignature = normaliseString(signature);

                // Encode signature for use in mail-to link
                let encodedSignature = encodeURIComponent(normalisedSignature).replace(/%20/g, " ");

                // Create mail-to link
                let mailToLink = `mailto:exampleEmail1@email.com,exampleEmail2@email.com?subject=${subjectLine}&&body=${encodeURIComponent(emailMessageBody + encodedSignature)}`;
                console.log(encodedSignature)

                // Open email client with pre-filled email
                window.location.href = mailToLink;
            }
        </script>
    </head>
    <body>
        <div>
            <p>Please sign your name and we will write and sign the below email on your behalf.</p>
            <textarea class="signature-box" id="signature" name="signature" placeholder="Type your full name here"></textarea>
            <input class="send-email-button" type="button" value="Send Email" onclick="sendEmail()">
            <h3><script>document.write(subjectLine)</script></h3>
            <p><script>document.write(emailMessageBody)</script></p>
        </div>
        <footer>
            <h4>Made by Sarah Caulfield</h4>
            <a href="https://www.linkedin.com/in/scaulfield7/">LinkedIn</a>&nbsp;&nbsp;|&nbsp;&nbsp;
            <a href="https://github.com/scaulfield7">GitHub</a>&nbsp;&nbsp;|&nbsp;&nbsp;
            <a href="https://ko-fi.com/scaulfield7">Ko-fi</a>
        </footer>
    </body>
</html>
